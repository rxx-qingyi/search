# My Electron App - 项目功能提示词文档

## 项目概览

这是一个基于 Electron + React 的桌面应用，功能类似于 macOS 的 Spotlight 或 Windows 的快速启动工具。用户通过全局快捷键快速打开搜索窗口，搜索和执行各种操作。

**项目名称**: My Electron App  
**版本**: 1.0.0  
**作者**: QingYiirz  
**许可证**: MIT

---

## 核心功能模块

### 1. 全局快捷键系统

**功能描述**: 提供全局快捷键支持，用户可以在任何应用中快速调用搜索窗口。

**快捷键绑定**:
- **Shift+F**: 切换搜索窗口显示/隐藏，显示时自动获得焦点
- **Escape**: 隐藏搜索窗口（全局快捷键）

**实现位置**: `main.js` 中的 `registerGlobalShortcuts()` 函数

**提示词**:
```
实现全局快捷键系统，支持 Shift+F 快速切换搜索窗口的显示隐藏状态。
当快捷键触发时，如果窗口可见则隐藏，不可见则显示并自动获得焦点。
同时支持 ESC 键全局隐藏窗口。
快捷键应在应用启动时自动注册，应用退出时清理快捷键。
```

---

### 2. 搜索窗口管理

**功能描述**: 管理浮窗的创建、显示、隐藏和布局。

**窗口特性**:
- **初始大小**: 500×75 像素
- **始终置顶**: 窗口保持在其他应用之上
- **无边框**: 隐藏所有窗口控件（关闭/最小化/最大化按钮）
- **无任务栏**: 不在任务栏显示该窗口
- **不可调整大小**: 用户无法手动改变窗口大小
- **禁用最小化/最大化**: 只能隐藏和显示
- **透明背景**: 支持 macOS 上的拖动操作

**实现位置**: `main.js` 中的 `createWindow()` 函数

**提示词**:
```
创建一个 Electron 浮窗应用，要求：
- 初始尺寸 500×75 px，始终置顶显示
- 无边框、不可调整大小、不显示在任务栏
- 禁用最小化和最大化功能，保留关闭功能但改为隐藏窗口
- 支持拖动窗口移动位置
- 在 macOS 上需要透明窗口支持，Windows/Linux 需要调整
- 开发环境加载本地 webpack dev server (http://localhost:8080)
- 生产环境加载打包后的 dist/index.html
```

---

### 3. 窗口拖动功能

**功能描述**: 允许用户通过拖动输入框或其他区域来移动窗口。

**拖动逻辑**:
- **输入框拖动**: 拖动超过 5px 时触发窗口拖动，允许正常输入
- **其他区域拖动**: 直接拖动移动窗口
- **拖动条**: 顶部 10px 透明区域可直接拖动

**实现位置**: 
- 主进程: `main.js` 的 IPC 处理 (`window-drag-start`, `window-drag`, `window-drag-end`)
- 渲染进程: `App.js` 中的鼠标事件处理

**提示词**:
```
实现窗口拖动功能，要求：
1. 输入框上的拖动：用户点击输入框时可以输入文字，但拖动距离超过 5px 后触发窗口移动
2. 其他区域拖动：点击输入框外的任何区域可以直接拖动窗口
3. 拖动条：在顶部提供 10px 高度的透明拖动区域
4. 通过主进程的 IPC 通信实现拖动的计算和窗口移动
5. 保留用户在输入框的点击、输入、选择文本等操作的优先级

拖动流程：
- 记录鼠标按下时的位置和窗口位置
- 计算鼠标移动的距离
- 根据距离和点击目标判断是否启动拖动
- 实时更新窗口位置
- 鼠标抬起时停止拖动
```

---

### 4. 窗口动态高度调整

**功能描述**: 根据搜索结果数量动态调整窗口高度。

**高度计算规则**:
- **无搜索**: 75px（输入框高度）
- **有搜索**: 50px(输入框) + 搜索结果高度 + 滚动提示高度
- **搜索结果项高度**: 50px/项
- **最大可见项数**: 3 项
- **滚动提示**: 当结果超过 3 项时显示（24px）
- **最大高度限制**: 600px

**实现位置**: 
- 主进程: `main.js` 的 `resize-window` IPC 处理
- 渲染进程: `App.js` 的 `useEffect` 中的高度计算

**提示词**:
```
实现窗口动态高度调整系统：
1. 无搜索内容时，窗口高度恢复为初始的 75px
2. 每输入搜索词时，根据匹配的结果数量计算需要的高度
3. 高度计算公式: 50px + min(结果数, 3) × 50px + (结果数 > 3 ? 24px : 0)
4. 窗口高度有最大限制，不超过 600px
5. 调整高度时保持窗口位置不变
6. 所有高度调整通过 IPC 通信在主进程中执行
```

---

### 5. 搜索和过滤系统

**功能描述**: 实现快速搜索，支持模糊匹配和多种搜索类型。

**搜索类型**:

#### 5.1 快速操作 (Action)
- 打开终端 (🖥️ terminal)
- 打开 Photoshop (🎨 photoshop)
- 打开记事本 (📝 notepad)
- 打开 Safari (🌏 safari)

#### 5.2 计算器 (Calc)
- 支持数学表达式计算
- 结果自动复制到剪贴板

#### 5.3 网页搜索 (Web)
- 自动在搜索结果末尾追加网页搜索选项
- 支持 Google 搜索

**搜索匹配**:
- 模糊匹配搜索词（不分大小写）
- 匹配标题 (title) 和描述 (desc) 字段
- 支持空格分隔的多个关键词匹配

**实现位置**: `App.js` 中的搜索过滤逻辑

**提示词**:
```
实现搜索过滤系统：
1. 预定义搜索项包括：快速操作（终端、PS、记事本、Safari）和计算器功能
2. 每个搜索项包含：type, icon, title, desc, content, action
3. 过滤逻辑：
   - 将用户输入转换为小写
   - 逐项检查 title 和 desc 是否包含搜索词
   - 返回所有匹配项
4. 在搜索结果末尾自动添加网页搜索选项（Google 搜索）
5. 无搜索内容时显示所有快捷操作
6. 匹配项和网页搜索都应该可点击或按 Enter 执行
```

---

### 6. 键盘导航系统

**功能描述**: 支持使用键盘快速导航和执行搜索结果。

**快捷键功能**:
- **↑ ArrowUp**: 在搜索结果中向上选择
- **↓ ArrowDown**: 在搜索结果中向下选择
- **Enter**: 执行当前选中的搜索结果
- **Escape**: 隐藏搜索窗口

**选择行为**:
- 默认选中第一项 (selectedIndex = 0)
- 向下选择时不超过最后一项
- 向上选择时不低于第一项
- 鼠标悬停自动切换选中项

**实现位置**: `App.js` 中的 `handleKeyDown` 事件处理

**提示词**:
```
实现键盘导航系统：
1. 使用 Arrow Up/Down 键在搜索结果间移动选择
2. 约束条件：不允许超出结果边界
3. 按 Enter 键执行当前选中的项
4. 按 Escape 键隐藏窗口
5. 所有导航都需要实时反馈，高亮显示当前选中项
6. 鼠标悬停时自动更新选中项
```

---

### 7. 搜索结果执行

**功能描述**: 根据搜索项类型执行相应的操作。

**执行类型及操作**:

#### 7.1 快速操作 (action: terminal, photoshop, notepad, safari)
- 使用 Electron 的 `shell.openExternal()` 或其他方式启动应用

#### 7.2 计算器 (action: calc)
```javascript
流程：
1. 验证输入是否为有效的数学表达式
2. 使用 eval() 计算结果（过滤非数学字符）
3. 将结果复制到系统剪贴板
4. 清空输入框
5. 隐藏搜索窗口
```

#### 7.3 网页搜索 (action: google)
```javascript
流程：
1. 检测搜索项是否为 web 类型
2. 根据 action 生成搜索 URL (Google)
3. 使用 shell.openExternal() 打开浏览器
4. 清空输入框并隐藏窗口
```

**实现位置**: `App.js` 中的 `performSearch()` 函数

**提示词**:
```
实现搜索结果执行系统：
1. 快速操作：启动对应的应用程序或系统功能
2. 计算器：
   - 解析用户输入的数学表达式
   - 过滤掉非数学字符（只保留 0-9, +, -, *, /, (, )）
   - 使用 eval() 计算结果
   - 检查结果是否为有效数字
   - 将结果复制到系统剪贴板，通知用户
   - 清空输入并隐藏窗口
3. 网页搜索：
   - 生成正确的搜索 URL (Google: https://www.google.com/search?q={query})
   - 使用系统默认浏览器打开
   - 清空输入并隐藏窗口
4. 所有操作完成后统一隐藏窗口和清空输入框
```

---

### 8. 用户界面 (UI)

**功能描述**: 提供现代化的搜索界面。

**界面结构**:
```
┌─────────────────────────────────────┐
│ [拖动条 - 10px 透明区域]             │
├─────────────────────────────────────┤
│ [搜索输入框 - 40px]                  │  ← placeholder: "搜索..."
├─────────────────────────────────────┤
│ [搜索结果项 1 - 50px]                │  ← 显示时出现
│ [搜索结果项 2 - 50px]                │
│ [搜索结果项 3 - 50px]                │
├─────────────────────────────────────┤
│ ↓ 向下滚动查看更多 - 24px            │  ← 结果 > 3 时出现
└─────────────────────────────────────┘
```

**输入框样式**:
- 字体大小: 18px
- 高度: 40px (相对于窗口 75px 基础高度，显示为占满)
- 实际渲染高度: 40px
- 宽度: 100%
- 无边框，白色背景
- 占位符文本: "搜索..."
- 暗灰色占位符颜色: #666

**搜索结果项样式**:
- 高度: 50px
- 分布结构:
  - 左侧: emoji 图标 (24px, 占位 32px)
  - 中间: 标题和描述 (flex 填充)
  - 右侧: 操作指示
- 标题字体: 14px, 500 weight, 颜色 #333
- 描述字体: 12px, 颜色 #999
- 鼠标悬停: 浅蓝色背景 (rgba(0, 122, 204, 0.1))
- 选中状态: 相同的背景色
- 边界: 下方 1px 浅灰色分割线

**滚动提示样式**:
- 高度: 24px
- 背景: 浅灰色 (#f9f9f9)
- 文字: 12px, 灰色 (#999)
- 内容: "↓ 向下滚动查看更多"
- 不可选中，不可拖动

**全局样式**:
- 字体族: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif
- 背景色: 白色
- 文本选择: 默认禁用，输入框启用

**滚动条样式** (WebKit):
- 宽度: 6px
- 轨道: 透明
- 滑块: #ccc，悬停 #999
- 圆角: 3px

**实现位置**: `App.js` (JSX 布局) 和 `styles.css` (样式定义)

**提示词**:
```
实现现代化搜索界面：
1. 布局结构：
   - 顶部 10px 透明拖动条
   - 搜索输入框 (40px 高)
   - 搜索结果区域（最多显示 3 个结果，每个 50px）
   - 滚动提示区域（结果超过 3 个时显示，24px）
   
2. 搜索输入框：
   - 占满窗口宽度，24px 字体
   - 无边框、圆角为 0
   - 白色背景，焦点时保持白色
   - 占位符："搜索..."，颜色 #666
   - 允许文本选择和编辑
   
3. 搜索结果项：
   - 50px 高度，20px 水平边距
   - 左侧 emoji 图标 (24px) + 右边距 12px
   - 中间标题 (14px, 500 weight, #333) 和描述 (12px, #999)
   - 悬停/选中：浅蓝色背景 (rgba(0, 122, 204, 0.1))
   - 下边框：1px #f0f0f0
   - 光标样式：pointer
   
4. 滚动：
   - 最多显示 3 个结果，超过时显示滚动提示
   - 自定义滚动条：6px 宽，#ccc 颜色
   - 垂直滚动，隐藏水平滚动条
   
5. 全局样式：
   - 系统字体栈
   - 禁用用户选择（除了输入框）
   - 禁用右键菜单
```

---

### 9. IPC 通信

**功能描述**: 主进程与渲染进程之间的通信机制。

**IPC 通道**:

| 通道名 | 方向 | 数据 | 描述 |
|------|------|------|------|
| `focus-search` | 主 → 渲染 | 无 | 主进程通知渲染进程聚焦搜索输入框 |
| `window-drag-start` | 渲染 → 主 | `{x, y}` | 渲染进程通知主进程开始拖动（鼠标位置） |
| `window-drag` | 渲染 → 主 | `{x, y}` | 渲染进程通知主进程正在拖动（当前鼠标位置） |
| `window-drag-end` | 渲染 → 主 | 无 | 渲染进程通知主进程停止拖动 |
| `resize-window` | 渲染 → 主 | `{height}` | 渲染进程通知主进程调整窗口高度 |
| `hide-window` | 渲染 → 主 | 无 | 渲染进程请求主进程隐藏窗口 |

**实现位置**: 
- 主进程: `main.js` 中的 `ipcMain.on()` 处理
- 渲染进程: `App.js` 中的 `ipcRenderer.send()` 调用

**提示词**:
```
实现 IPC 通信系统以支持主渲染进程交互：
1. focus-search: 主进程告诉渲染进程自动聚焦搜索框
2. window-drag-start: 渲染进程发送鼠标按下时的屏幕坐标
3. window-drag: 渲染进程实时发送鼠标移动的屏幕坐标
4. window-drag-end: 渲染进程发送拖动结束信号
5. resize-window: 渲染进程请求主进程调整窗口高度
6. hide-window: 渲染进程请求主进程隐藏窗口

主进程需要实时处理这些通信，计算并执行对应操作。
```

---

### 10. 开发和构建流程

**功能描述**: 项目的开发工作流和构建配置。

**开发环境**:
- **Hot Reload**: 支持 webpack dev server 热更新
- **Dev Server**: 在 `http://localhost:8080` 运行
- **并发运行**: webpack 服务和 Electron 同时启动
- **自动重试**: 服务器未启动时自动重试
- **开发者工具**: 默认打开浏览器开发者工具

**构建工具**:
- **Webpack**: 代码打包和模块化
- **Babel**: 现代 JavaScript 转译
- **React**: UI 框架
- **Electron**: 桌面应用框架
- **Electron Builder**: 应用打包分发

**构建命令**:
- `npm run dev`: 开发模式（热更新）
- `npm run build`: 生产构建（输出到 dist/）
- `npm start`: 构建并启动应用
- `npm run dist`: 打包为可分发应用
- `npm run dist:mac`: 打包为 macOS 应用
- `npm run dist:dir`: 打包为文件夹（不生成安装程序）

**输出配置**:
- **打包输出**: `release/` 文件夹
- **Web 输出**: `dist/` 文件夹
- **支持平台**: macOS (x64, arm64)，可扩展到 Windows/Linux

**实现位置**: `package.json` 和 `webpack.config.js`

**提示词**:
```
配置完整的开发和构建流程：
1. 开发环境：
   - Webpack Dev Server 在 :8080 提供热更新
   - Electron 应用连接到本地开发服务器
   - 支持快速 F5 重新加载
   - 打开开发者工具用于调试
   
2. 生产构建：
   - Webpack 打包所有代码到 dist/ 目录
   - Babel 转译现代 JavaScript
   - 压缩和优化资源
   
3. 应用打包：
   - Electron Builder 打包可执行应用
   - 支持 macOS DMG 和 ZIP 格式
   - 包含必要的依赖和资源
   - 输出到 release/ 目录
   
4. 提供 npm scripts 用于快速开发和生产
```

---

## 完整项目结构

```
my-electron-app/
├── main.js                 # Electron 主进程
├── package.json           # 项目配置和依赖
├── webpack.config.js      # Webpack 配置
├── .babelrc              # Babel 转译配置
├── .gitignore            # Git 忽略文件
├── src/
│   ├── App.js            # React 主应用组件
│   ├── index.js          # React 入口
│   ├── index.html        # HTML 模板
│   └── styles.css        # 全局样式
├── dist/                 # 生产构建输出
└── release/              # 应用打包输出
```

---

## 快速开发提示词总结

### 如果要添加新功能，可以使用以下提示词：

**添加新的快速操作**:
```
在搜索建议列表中添加新的快速操作。
需要提供：
- type: 'action'
- icon: emoji 图标
- title: 操作名称
- desc: 搜索关键词（用空格分隔）
- content: 描述信息
- action: 唯一标识符

然后在 performSearch 函数中添加对应的 action 处理逻辑。
```

**添加新的网页搜索引擎**:
```
在 performSearch 函数的网页搜索部分添加新的 case。
需要生成正确的搜索 URL，例如：
- YouTube: https://www.youtube.com/results?search_query={query}
- 淘宝: https://s.taobao.com/search?q={query}
- 网易音乐: https://music.163.com/search/get?s={query}

然后在搜索建议列表中添加对应的项目类型。
```

**优化搜索算法**:
```
当前搜索使用简单的 includes() 方法。
可以改进为：
- 前缀匹配优先级更高
- 支持拼音搜索（需要拼音库）
- 支持模糊搜索（编辑距离）
- 添加结果排序和权重系统
```

**扩展拖动功能**:
```
当前实现基于鼠标事件的手动拖动。
可以扩展为：
- 触摸屏支持（触控板拖动）
- 自定义拖动手柄区域
- 保存窗口位置持久化
- 快捷键改变窗口大小
```

---

## 关键技术栈

- **Electron**: 跨平台桌面应用框架
- **React 18**: UI 库，Hooks API
- **Webpack 5**: 模块打包工具
- **Babel 7**: JavaScript 转译器
- **Electron Builder**: 应用打包和分发
- **Node.js**: 运行时环境

## 核心依赖版本

- electron: ^37.4.0
- react: ^18.3.1
- react-dom: ^18.3.1
- webpack: ^5.91.0
- webpack-dev-server: ^5.0.4

---

## 开发注意事项

1. **安全性**: 渲染进程启用了 `nodeIntegration: true` 和 `contextIsolation: false`，生产环境应该改为 `contextIsolation: true` 并使用 preload 脚本

2. **性能**: 使用 React Hooks 管理状态，避免不必要的重新渲染

3. **跨平台**: 某些功能（如应用启动）需要根据平台适配

4. **快捷键冲突**: 全局快捷键 Shift+F 可能与其他应用冲突，需要错误处理

5. **隐私**: 计算器使用 `eval()` 存在安全隐患，应使用更安全的数学解析库

---

**文档生成时间**: 2025-12-01  
**最后更新**: v1.0.0

